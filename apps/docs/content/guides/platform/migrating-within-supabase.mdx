---
title: Migrating within Supabase
subtitle: Learn how to migrate from one Supabase project to another
---

<Admonition type="note">

If you are on a Paid plan and have physical backups enabled, you should instead use the [Restore to another project feature](/docs/guides/platform/backups#restore-to-a-new-project)

</Admonition>

### Caveats

- If you need to move your project to a different organization without touching the infrastructure, see [project transfers](/docs/guides/platform/project-transfer).

- **This guide only migrates the Postgres database**. Some common items to re-configure in the new project include:
  - Auth Settings and API keys
  - Edge Functions
  - Read Replicas
  - Realtime configuration

### Before you begin

    <Accordion

type="default"
openBehaviour="multiple"
chevronAlign="right"
justified
className="text-foreground-light mt-8 mb-6"

>

  <div className="border-b mt-3 pb-3">
    <AccordionItem
      header={<span className="text-foreground">Install postgres and psql</span>}
      id="install-postgres"
    >
      <$Partial path="postgres_installation.mdx" />
    </AccordionItem>
  </div>
  </Accordion>

<Accordion
  type="default"
  openBehaviour="multiple"
  chevronAlign="right"
  justified
  size="medium"
  className="text-foreground-light mt-8 mb-6"
>
    <div className="border-b mt-3 pb-3">
        <AccordionItem
        header={<span className="text-foreground">Manual database dump if you do not have a backup</span>}
        id="backup-project"
        >
        <StepHikeCompact>
  <StepHikeCompact.Step step={1}>
    <StepHikeCompact.Details title="Install the Supabase CLI" fullWidth>
    Install the [Supabase CLI](/docs/guides/local-development/cli/getting-started).
    </StepHikeCompact.Details>
  </StepHikeCompact.Step>

<StepHikeCompact.Step step={2}>
  <StepHikeCompact.Details title="Install Docker Desktop" fullWidth>
    Install [Docker Desktop](https://www.docker.com) for your platform.
  </StepHikeCompact.Details>
</StepHikeCompact.Step>

  <StepHikeCompact.Step step={3}>
    <StepHikeCompact.Details title="Get the new database connection string" fullWidth>
      Get your Session pooler connection string from your [Connect page](https://supabase.com/dashboard/project/_?showConnect=true). Example connection string:
      ```bash
        postgresql://postgres.[PROJECT-REF]:[YOUR-PASSWORD]@aws-0-[PROJECT-REGION].pooler.supabase.com:5432/postgres
      ```
    </StepHikeCompact.Details>

  </StepHikeCompact.Step>

  <StepHikeCompact.Step step={4}>
    <StepHikeCompact.Details title="Get the database password" fullWidth>
      Reset and copy the password in the [Database Settings](/dashboard/project/_/settings/database). Replace ```[YOUR-PASSWORD]``` in step 3 with the database password.
    </StepHikeCompact.Details>

  </StepHikeCompact.Step>

  <StepHikeCompact.Step step={5}>
      <StepHikeCompact.Details title="Backup database" fullWidth>
       Run these commands after replacing ```[CONNECTION_STRING]``` with your connection string from the previous steps:

        ```bash
        supabase db dump --db-url [CONNECTION_STRING] -f roles.sql --role-only
        supabase db dump --db-url [CONNECTION_STRING] -f schema.sql
        supabase db dump --db-url [CONNECTION_STRING] -f data.sql --use-copy --data-only
        ```
      </StepHikeCompact.Details>
    </StepHikeCompact.Step>

</StepHikeCompact>
        </AccordionItem>
  </div>
</Accordion>

### Restore database backup

<StepHikeCompact>
    <StepHikeCompact.Step step={1}>
        <StepHikeCompact.Details title="Create and configure new Supabase project" fullWidth>
          Create a [new project](https://database.new). In the new project:
            - If Webhooks were used in the old database, enable [Database Webhooks](/dashboard/project/_/database/hooks).
            - If any non-default extensions were used in the old database, enable the [Extensions](/dashboard/project/_/database/extensions).
        </StepHikeCompact.Details>
    </StepHikeCompact.Step>

    <StepHikeCompact.Step step={2}>
      <StepHikeCompact.Details title="Get the Session pooler connection string for the newly created project" fullWidth>
      Get your Session pooler connection string from your [Connect page](https://supabase.com/dashboard/project/_?showConnect=true). Example connection string:
      ```bash
        postgresql://postgres.[PROJECT-REF]:[YOUR-PASSWORD]@aws-0-[PROJECT-REGION].pooler.supabase.com:5432/postgres
      ```
      </StepHikeCompact.Details>

    </StepHikeCompact.Step>

    <StepHikeCompact.Step step={4}>

    <StepHikeCompact.Details title="Get the database password for the newly created project" fullWidth>
      Reset and copy the password in the [Database Settings](/dashboard/project/_/settings/database). Replace ```[YOUR-PASSWORD]``` in step 2 with the database password.
    </StepHikeCompact.Details>
    </StepHikeCompact.Step>

    <StepHikeCompact.Step step={5}>
      <StepHikeCompact.Details title="Restore your database backup with psql" fullWidth>
          Replace ```[CONNECTION_STRING]``` with your connection string. Select the appropriate option and run the command:

        <Tabs
          scrollable
          size="large"
          type="underlined"
          defaultActiveId="backup-file"
        >
          <TabPanel id="backup-file" label="*.backup file">
          ```bash
          psql -d [CONNECTION_STRING] -f file/path
          ```
          </TabPanel>

          <TabPanel id="sql-file" label="*.sql files">
          ```bash
          psql \
            --single-transaction \
            --variable ON_ERROR_STOP=1 \
            --file roles.sql \
            --file schema.sql \
            --file data.sql \
            --dbname [CONNECTION_STRING]
          ```
          </TabPanel>
        </Tabs>
      </StepHikeCompact.Details>

  </StepHikeCompact.Step>
</StepHikeCompact>

### Migrate Storage

The new project has the old project's Storage buckets, but the Storage objects need to be migrated manually. Migrate storage objects to the new project with the local only [Supabase Storage Migrator tool](https://plyn.github.io/supabase-storage-migrator/).

<Accordion
  type="default"
  openBehaviour="multiple"
  chevronAlign="right"
  justified
  size="medium"
  className="text-foreground-light mt-8 mb-6"
>
    <div className="border-b mt-3 pb-3">
        <AccordionItem
        header={<span className="text-foreground">Alternative Storage migration options</span>}
        id="backup-project"
        >
        If you have your storage objects locally (e.g. 90 day paused projects), migrate the storage objects to the new project using this [Google Colab script](https://colab.research.google.com/github/PLyn/supabase-storage-migrate/blob/main/Supabase_Storage_migration.ipynb).

        If the old project is still active, use this script to move storage objects from one project to another:

        ```js
        // npm install @supabase/supabase-js@1
        const { createClient } = require('@supabase/supabase-js')

        const OLD_PROJECT_URL = 'https://xxx.supabase.co'
        const OLD_PROJECT_SERVICE_KEY = 'old-project-service-key-xxx'

        const NEW_PROJECT_URL = 'https://yyy.supabase.co'
        const NEW_PROJECT_SERVICE_KEY = 'new-project-service-key-yyy'

        ;(async () => {
        const oldSupabaseRestClient = createClient(OLD_PROJECT_URL, OLD_PROJECT_SERVICE_KEY, {
        schema: 'storage',
        })
        const oldSupabaseClient = createClient(OLD_PROJECT_URL, OLD_PROJECT_SERVICE_KEY)
        const newSupabaseClient = createClient(NEW_PROJECT_URL, NEW_PROJECT_SERVICE_KEY)

        // make sure you update max_rows in postgrest settings if you have a lot of objects
        // or paginate here
        const { data: oldObjects, error } = await oldSupabaseRestClient.from('objects').select()
        if (error) {
        console.log('error getting objects from old bucket')
        throw error
        }

        for (const objectData of oldObjects) {
        console.log(`moving ${objectData.id}`)
        try {
        const { data, error: downloadObjectError } = await oldSupabaseClient.storage
        .from(objectData.bucket_id)
        .download(objectData.name)
        if (downloadObjectError) {
        throw downloadObjectError
        }

            const { _, error: uploadObjectError } = await newSupabaseClient.storage
                .from(objectData.bucket_id)
                .upload(objectData.name, data, {
                upsert: true,
                contentType: objectData.metadata.mimetype,
                cacheControl: objectData.metadata.cacheControl,
                })
            if (uploadObjectError) {
                throw uploadObjectError
            }
            } catch (err) {
            console.log('error moving ', objectData)
            console.log(err)
            }

        }
        })()
        ```
        </AccordionItem>

  </div>
</Accordion>

### Troubleshooting notes

- If you have created any custom roles with login attribute, you have to manually set their passwords in the new project.
- If you get this error: **"...received invalid response to GSSAPI negotiation..."**. You are likely using psql and Postgres version 15 or lower. Install the latest version to resolve this issue.
